{# Gallery of all locked artworks with unlock and delete actions. #}
{% extends "main.html" %}
{% block title %}Locked Artworks{% endblock %}
{% block content %}
<div class="container">
  <div class="page-title-row">
    <img src="{{ url_for('static', filename='icons/svg/light/lock-light.svg') }}" class="hero-step-icon" alt="Locked" />
    <h1>Locked Artworks</h1>
  </div>
  <p class="help-tip">These artworks are locked and cannot be edited until unlocked. They are excluded from most exports.</p>
  <div class="view-toggle">
    <button id="grid-view-btn" class="btn-small">Grid</button>
    <button id="list-view-btn" class="btn-small">List</button>
  </div>

  {% if not artworks %}
    <p>No artworks are currently locked.</p>
  {% else %}
  <div class="finalised-grid" data-view-key="lockedView">
    {% for art in artworks %}
    <div class="final-card">
      <div class="card-thumb">
        {# Use the 'locked_image' route for these images #}
        {% set main_path = art.seo_folder ~ '/' ~ (art.main_image or '') %}
        {% if art.main_image %}
        <a href="{{ url_for('artwork.locked_image', filename=main_path) }}" class="final-img-link" data-img="{{ url_for('artwork.locked_image', filename=main_path) }}">
          <img src="{{ url_for('artwork.locked_image', filename=main_path) }}" class="card-img-top" alt="{{ art.title|default('Untitled') }}">
        </a>
        {% else %}
        <img src="{{ url_for('static', filename='img/no-image.svg') }}" class="card-img-top" alt="No image">
        {% endif %}
      </div>
      <div class="card-details">
        <div class="card-title">{{ art.title|default('Untitled') }}</div>
        {# FIX: Use default filter to prevent errors on missing keys #}
        <div class="desc-snippet" title="{{ art.description|default('') }}">
          {{ art.description|default('')|truncate(200) }}
        </div>
        <div>SKU: {{ art.sku|default('') }}</div>
        <div>Price: {{ art.price|default('') }}</div>
        <div>Colours: {{ art.primary_colour|default('') }} / {{ art.secondary_colour|default('') }}</div>
        <div>SEO: {{ art.seo_filename|default('') }}</div>
        <div>Tags: {{ art.tags|default([])|join(', ') }}</div>
        <div>Materials: {{ art.materials|default([])|join(', ') }}</div>
      </div>
      <div class="button-row">
        <a class="art-btn disabled" aria-disabled="true">Edit</a>
        <form method="post" action="{{ url_for('artwork.unlock_artwork', seo_folder=art.seo_folder) }}">
          <button type="submit" class="art-btn">Unlock</button>
        </form>
        <form method="post" action="{{ url_for('artwork.delete_artwork', seo_folder=art.seo_folder) }}" class="locked-delete-form">
          <input type="hidden" name="confirm" value="">
          <button type="submit" class="art-btn delete">Delete</button>
        </form>
      </div>
    </div>
    {% endfor %}
  </div>
  {% endif %}
</div>

<div id="image-modal" class="modal">
  <span class="close-modal">&times;</span>
  <img class="modal-content" id="modal-img-content">
</div>
{% endblock %}
